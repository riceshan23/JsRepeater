/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["JsRepeater"] = factory();
	else
		root["JsRepeater"] = factory();
})(this, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ ((module) => {

eval("function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArrayLimit(arr, i) { var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (null != _i) { var _s, _e, _x, _r, _arr = [], _n = !0, _d = !1; try { if (_x = (_i = _i.call(arr)).next, 0 === i) { if (Object(_i) !== _i) return; _n = !1; } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0) { ; } } catch (err) { _d = !0, _e = err; } finally { try { if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return; } finally { if (_d) throw _e; } } return _arr; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\nvar JsRepeater = function () {\n  var isObject = function isObject(item) {\n    return _typeof(item) === 'object' && !Array.isArray(item) && item !== null;\n  };\n  var isFunction = function isFunction(item) {\n    return typeof item === 'function';\n  };\n  var isNumeric = function isNumeric(item) {\n    return !isNaN(parseFloat(item)) && isFinite(item);\n  };\n  var addCSSRule = function addCSSRule(selector, rules) {\n    if (!window._repeaterAnimationSheet) {\n      window._repeaterAnimationSheet = document.createElement('style');\n      document.head.appendChild(window._repeaterAnimationSheet);\n    }\n    var sheet = window._repeaterAnimationSheet.sheet;\n    sheet.insertRule(\"\".concat(selector, \" { \").concat(rules, \" }\"), sheet.cssRules.length);\n  };\n\n  // Repeater main\n  function create(mainElement) {\n    var _listEl$dataset;\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var _options$defaultValue = options.defaultValues,\n      _defaultValues = _options$defaultValue === void 0 ? {} : _options$defaultValue,\n      _options$animationMs = options.animationMs,\n      _animationMs = _options$animationMs === void 0 ? -1 : _options$animationMs,\n      _options$deleteInputN = options.deleteInputName,\n      _deleteInputName = _options$deleteInputN === void 0 ? '' : _options$deleteInputN,\n      _options$deleteInputF = options.deleteInputField,\n      _deleteInputField = _options$deleteInputF === void 0 ? '' : _options$deleteInputF,\n      _options$onItemAdded = options.onItemAdded,\n      _onItemAdded = _options$onItemAdded === void 0 ? null : _options$onItemAdded,\n      _options$afterItemAdd = options.afterItemAdded,\n      _afterItemAdded = _options$afterItemAdd === void 0 ? null : _options$afterItemAdd,\n      _options$onItemRemove = options.onItemRemoved,\n      _onItemRemoved = _options$onItemRemove === void 0 ? null : _options$onItemRemove;\n    var _mainElement$dataset$ = mainElement.dataset.repeaterInit,\n      repeaterInit = _mainElement$dataset$ === void 0 ? undefined : _mainElement$dataset$;\n    if (repeaterInit) {\n      console.error('Cant not create instance twice');\n      return;\n    }\n    if (!isObject(_defaultValues)) throw new Error('Parameter [defaultValues] type error (object)');\n    if (_onItemAdded !== null && !isFunction(_onItemAdded)) throw new Error('Parameter [onItemAdded] type error (function)');\n    if (_afterItemAdded !== null && !isFunction(_afterItemAdded)) throw new Error('Parameter [afterItemAdded] type error (function)');\n    if (_onItemRemoved !== null && !isFunction(_onItemRemoved)) throw new Error('Parameter [onItemRemoved] type error (function)');\n    if (!isNumeric(_animationMs)) throw new Error('Parameter animationMs [animationMs] type error (Number)');\n    var listEl = mainElement.querySelector('[data-repeater-list]');\n    if (!listEl) throw new Error('data-repeater-list not found');\n    var groupName = (_listEl$dataset = listEl.dataset) === null || _listEl$dataset === void 0 ? void 0 : _listEl$dataset.repeaterList;\n    if (!groupName) throw new Error('data-repeater-list is required');\n    var itemTemplate = listEl.querySelector('[data-repeater-item]').cloneNode(true);\n    listEl.innerHTML = '';\n    var createBtn = mainElement.querySelector('[data-repeater-create]');\n    mainElement.dataset.repeaterInit = true;\n    if (_animationMs > 0) initializeAnimationCSS();\n    function setIndexes() {\n      Array.from(listEl.querySelectorAll('[data-repeater-item]')).forEach(function (item, index) {\n        item.dataset.itemName = \"\".concat(groupName, \"[\").concat(index, \"]\");\n        item.querySelectorAll('[name]').forEach(function (input) {\n          var name = input.getAttribute('name');\n          // handle array (checkbox, multiple select ..)\n          var matches = name.endsWith('[]');\n          name = parseFormName(name);\n          if (!name.match(/\\[.*\\]$/)) name = \"[\".concat(name, \"]\");\n          var newName = \"\".concat(groupName, \"[\").concat(index, \"]\").concat(name);\n          input.setAttribute('name', newName);\n        });\n      });\n    }\n    function addItems(array) {\n      if (!Array.isArray(array)) throw new Error('Function addItems Parameter type error (array)');\n      array.forEach(function (fig) {\n        return addItem(fig);\n      });\n    }\n    function addItem() {\n      var fig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (!isObject(fig.data)) {\n        if (!fig.data) {\n          fig.data = fig;\n        } else {\n          throw new Error('Function addItem Parameter type error (object)');\n        }\n      }\n      var newItem = itemTemplate.cloneNode(true);\n      if (_animationMs <= 0) {\n        listEl.appendChild(newItem);\n        _addItemAction(newItem, fig);\n      } else {\n        newItem.style.maxHeight = '0';\n        newItem.style.transition = \"max-height \".concat(_animationMs / 1000, \"s\");\n        listEl.appendChild(newItem);\n        requestAnimationFrame(function () {\n          var height = newItem.scrollHeight;\n          newItem.style.maxHeight = \"\".concat(height, \"px\");\n        });\n        setTimeout(function () {\n          newItem.style.maxHeight = '';\n          newItem.style.transition = '';\n          _addItemAction(newItem, fig);\n        }, _animationMs);\n      }\n    }\n    function _addItemAction(newItem, fig) {\n      setItemValues(newItem, fig);\n      setIndexes();\n      if (_onItemAdded) {\n        _onItemAdded(newItem, fig);\n        setIndexes();\n      }\n      if (_afterItemAdded) {\n        _afterItemAdded(newItem, fig);\n      }\n    }\n    function setItemValues(newItem, fig) {\n      var _fig$data = fig.data,\n        data = _fig$data === void 0 ? {} : _fig$data,\n        _fig$extra = fig.extra,\n        extra = _fig$extra === void 0 ? {} : _fig$extra;\n      Object.keys(data).forEach(function (key) {\n        var input = getItemInput(newItem, key);\n        if (input) {\n          var _fig$extra$key, _fig$extra2;\n          var inputObj = FormInput.create(input);\n          inputObj.set(data[key]);\n\n          /*****************\n           * extra setting *\n           *****************/\n          var extraFig = (_fig$extra$key = (_fig$extra2 = fig.extra) === null || _fig$extra2 === void 0 ? void 0 : _fig$extra2[key]) !== null && _fig$extra$key !== void 0 ? _fig$extra$key : undefined;\n\n          // handle readonly\n          if ((extraFig === null || extraFig === void 0 ? void 0 : extraFig.readonly) === true) {\n            inputObj.readonly();\n          }\n          // handle add class\n          if (Array.isArray(extraFig === null || extraFig === void 0 ? void 0 : extraFig.addClass)) {\n            var _input$classList;\n            (_input$classList = input.classList).add.apply(_input$classList, _toConsumableArray(extraFig === null || extraFig === void 0 ? void 0 : extraFig.addClass));\n          }\n        }\n      });\n    }\n    function getItemInput(newItem, key) {\n      return Array.from(newItem.querySelectorAll('[name]')).find(function (input) {\n        var name = input.getAttribute('name');\n        var parseName = parseFormName(name);\n        if (parseName == key) return true;\n\n        // handle [xxx] = xxx\n        var matches = parseName.match(/^\\[(.+)\\]$/);\n        if (matches !== null && matches !== void 0 && matches[1] && matches[1] == key) return true;\n      });\n    }\n    function parseFormName(input) {\n      return input.replace(groupName, '').replace(/^\\[\\d+\\]/, '');\n    }\n    function removeItem(item) {\n      if (_animationMs <= 0) {\n        listEl.removeChild(item);\n        setIndexes();\n        if (_onItemRemoved) {\n          _onItemRemoved(item);\n          setIndexes();\n        }\n      } else {\n        item.style.overflow = 'hidden';\n        item.style.transition = \"max-height \".concat(_animationMs / 1000, \"s ease\");\n        item.style.maxHeight = \"\".concat(item.scrollHeight, \"px\");\n        item.offsetHeight;\n        item.style.maxHeight = '0';\n        setTimeout(function () {\n          listEl.removeChild(item);\n          setIndexes();\n          if (_onItemRemoved) {\n            _onItemRemoved(item);\n            setIndexes();\n          }\n        }, _animationMs);\n      }\n    }\n    function genHiddenDeleteInput(itemEl) {\n      if (_deleteInputName == '' || _deleteInputField == '') return false;\n      var delFieldInput = getItemInput(itemEl, _deleteInputField);\n      if (delFieldInput && delFieldInput.value != '') {\n        var hiddenInput = document.createElement('input');\n        hiddenInput.setAttribute('type', 'hidden');\n        hiddenInput.setAttribute('name', _deleteInputName + '[]');\n        hiddenInput.value = delFieldInput.value;\n        return hiddenInput;\n      }\n      return false;\n    }\n    function getValues() {\n      var inputs = mainElement.querySelectorAll('[name]');\n      var formData = new FormData();\n      inputs.forEach(function (input) {\n        return formData.append(input.name, input.value);\n      });\n      return parseToNestedArray(formData);\n    }\n    function parseToNestedArray(formData) {\n      var result = {};\n      var entries = Object.entries(Object.fromEntries(formData.entries()));\n      var _loop = function _loop() {\n        var _entries$_i = _slicedToArray(_entries[_i], 2),\n          key = _entries$_i[0],\n          value = _entries$_i[1];\n        var paths = key.match(/[^\\[\\]]+/g) || [key]; // 修改正則以捕獲所有路徑部分\n        var current = result;\n        paths.forEach(function (path, index) {\n          var isLast = index === paths.length - 1;\n          if (isLast) {\n            current[path] = value;\n          } else {\n            // 檢查下一個路徑是否為數字\n            current[path] = current[path] || (!isNaN(paths[index + 1]) ? [] : {});\n            current = current[path];\n          }\n        });\n      };\n      for (var _i = 0, _entries = entries; _i < _entries.length; _i++) {\n        _loop();\n      }\n      return result; // 不再使用 Object.values()\n    }\n\n    function clear() {\n      listEl.innerHTML = '';\n    }\n    function disable() {\n      mainElement.querySelectorAll('input, select, textarea').forEach(function (input) {\n        return input.disabled = true;\n      });\n      createBtn.disabled = true;\n    }\n    function enable() {\n      mainElement.querySelectorAll('input, select, textarea').forEach(function (input) {\n        return input.disabled = false;\n      });\n      createBtn.disabled = false;\n    }\n\n    // Binding event\n    createBtn === null || createBtn === void 0 ? void 0 : createBtn.addEventListener('click', function (e) {\n      addItem({\n        data: _defaultValues\n      });\n    });\n    mainElement.addEventListener('click', function (e) {\n      var target = e.target;\n      if (target.matches('[data-repeater-delete]') || target.closest('[data-repeater-delete]')) {\n        var itemEl = target.closest('[data-repeater-item]');\n        var hiddenInput = genHiddenDeleteInput(itemEl);\n        if (hiddenInput) {\n          listEl.appendChild(hiddenInput);\n        }\n        removeItem(itemEl);\n      }\n    });\n\n    // CSS\n    function initializeAnimationCSS() {\n      addCSSRule('.animated-row', \"\\n        transition: all \".concat(_animationMs / 1000, \"s ease;\\n      \"));\n      addCSSRule('.animated-row.collapsed td > div', \"\\n        max-height: 0;\\n        transition: all \".concat(_animationMs / 1000, \"s ease;\\n      \"));\n      addCSSRule('.animated-row.expanded td > div', \"\\n        max-height: 100px;\\n        transition: all \".concat(_animationMs / 1000, \"s ease;\\n      \"));\n    }\n    return {\n      addItem: addItem,\n      addItems: addItems,\n      removeItem: removeItem,\n      clear: clear,\n      disable: disable,\n      enable: enable,\n      setIndexes: setIndexes,\n      getValues: getValues\n    };\n  }\n  var FormInput = {\n    createBaseInput: function createBaseInput(element) {\n      var self = {};\n      self.getType = function () {\n        return element.type || 'text';\n      };\n      self.get = function () {\n        return element.value;\n      };\n      self.set = function (newValue) {\n        return element.value = newValue;\n      };\n      self.clear = function () {\n        return self.set('');\n      };\n      self.readonly = function () {\n        return element.readOnly = true;\n      };\n      self.disable = function () {\n        return element.disabled = true;\n      };\n      self.enable = function () {\n        return element.disabled = false;\n      };\n      return self;\n    },\n    createInputCheckbox: function createInputCheckbox(element) {\n      var self = this.createBaseInput(element);\n      var form = element.form || document;\n      var inputName = \"input[type=\\\"checkbox\\\"][name=\\\"\".concat(element.name, \"\\\"]\");\n      self.get = function () {\n        return Array.from(form.querySelectorAll(\"\".concat(inputName, \":checked\"))).map(function (el) {\n          return el.value;\n        });\n      };\n      self.set = function (newValues) {\n        var _form$querySelectorAl;\n        newValues = Array.isArray(newValues) ? newValues : [newValues];\n        (_form$querySelectorAl = form.querySelectorAll(inputName)) === null || _form$querySelectorAl === void 0 ? void 0 : _form$querySelectorAl.forEach(function (el) {\n          return el.checked = newValues.includes(el.value);\n        });\n      };\n      return self;\n    },\n    createInputRadio: function createInputRadio(element) {\n      var self = this.createBaseInput(element);\n      var form = element.form || document;\n      var inputName = \"input[type=\\\"radio\\\"][name=\\\"\".concat(element.name, \"\\\"]\");\n      var radios = form.querySelectorAll(\"input[name=\\\"\".concat(element.name, \"\\\"]\"));\n      self.get = function () {\n        var _form$querySelector;\n        return ((_form$querySelector = form.querySelector(\"\".concat(inputName, \":checked\"))) === null || _form$querySelector === void 0 ? void 0 : _form$querySelector.value) || null;\n      };\n      self.set = function (newValue) {\n        if (newValue) {\n          var target = Array.from(radios).find(function (radio) {\n            return radio.value === newValue;\n          });\n          if (target) target.checked = true;\n        }\n      };\n      return self;\n    },\n    createSelect: function createSelect(element) {\n      var self = this.createBaseInput(element);\n      var form = element.form || document;\n      var isMultiple = element.hasAttribute('multiple');\n      self.get = function () {\n        if (isMultiple) {\n          return Array.from(element.selectedOptions).map(function (options) {\n            return options.value;\n          });\n        }\n        return element.value;\n      };\n      self.set = function (newValue) {\n        if (isMultiple) {\n          if (!Array.isArray(newValue)) throw new Error('Multiple select value must be an array');\n          for (var i = 0; i < element.options.length; i++) {\n            element.options[i].selected = newValue.includes(element.options[i].value);\n          }\n          return;\n        }\n        element.value = newValue;\n      };\n      self.readonly = function (newValue) {\n        Array.from(element.options).map(function (op) {\n          self.get() != op.value ? op.remove() : null;\n        });\n      };\n      return self;\n    },\n    create: function create(element) {\n      switch (element.tagName) {\n        case 'SELECT':\n          return this.createSelect(element);\n        default:\n          switch (element.type) {\n            case 'checkbox':\n              return this.createInputCheckbox(element);\n            case 'radio':\n              return this.createInputRadio(element);\n            default:\n              return this.createBaseInput(element);\n          }\n      }\n    }\n  };\n  return {\n    create: create\n  };\n}();\n\n// Webpack support\nif (true) {\n  module.exports = JsRepeater;\n}\n\n//# sourceURL=webpack://JsRepeater/./src/index.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});